<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>è¨‚é¤çµ±è¨ˆå°å·¥å…·</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <style>
    body{
      font-family:"å¾®è»Ÿæ­£é»‘é«”",sans-serif;
      background:#d6d6d6;
      padding:20px;
      max-width:900px;
      margin:0 auto;
    }
    h1,h2{ text-align:center; color:#333; }
    .card{
      background:#fff;
      padding:18px;
      border-radius:8px;
      box-shadow:0 2px 5px rgba(0,0,0,.1);
      margin-bottom:16px;
    }
    .input-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:center;
      align-items:center;
    }
    input,select,textarea,button{
      font-family:inherit;
      font-size:14px;
      padding:8px;
      border-radius:4px;
      border:1px solid #ccc;
    }
    textarea{ width:100%; box-sizing:border-box; }
    button{
      background:#81afa7;
      color:#fff;
      border:none;
      cursor:pointer;
      transition:.2s;
    }
    button:hover{ background:#328779; }
    .btn-danger{ background:#e8727e; }
    .btn-danger:hover{ background:#891924; }
    .btn-sm{ padding:3px 6px; font-size:12px; }
    .btn-edit{ background:#ffc107; color:#212529; }
    .btn-edit:hover{ background:#e0a800; }
    .btn-del{ background:#e8727e; }
    .btn-del:hover{ background:#891924; }
    table{
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
      font-size:13px;
    }
    th,td{
      border-bottom:1px solid #ddd;
      padding:6px 8px;
      text-align:left;
      vertical-align:top;
    }
    th{ background:#a1a279; color:#fff; }
    tr:hover{ background:#f7f7f7; }
    .total-box{
      text-align:right;
      font-weight:bold;
      color:#d9534f;
    }
  </style>
</head>
<body>

<h1>ğŸ± è¨‚é¤çµ±è¨ˆå°å·¥å…·</h1>

<!-- â‘  èœå–®è¨­å®š -->
<div class="card">
  <h2>â‘  èœå–®å“é …</h2>
  <div class="input-row">
    <input id="menuNameInput" placeholder="å“é …åç¨± (ä¾‹ï¼šè’œé¦™é›ªèŠ±ç‰›è‚‰å¹«ç±³çŸ­æ³•)" style="flex:1 1 160px;">
    <input id="menuPriceInput" type="number" min="0" placeholder="åƒ¹æ ¼" style="width:110px;">
    <button id="addMenuItemBtn">â• æ–°å¢å“é …</button>
    <button id="clearMenuBtn" class="btn-danger">ğŸ—‘ æ¸…é™¤èœå–®</button>
  </div>

  <div style="margin-top:10px;">
    <small>å¿«é€ŸåŒ¯å…¥ï¼ˆæ¯è¡Œï¼šå“é …,é‡‘é¡ï¼Œä¾‹å¦‚ï¼šæ’éª¨é£¯,100ï¼‰</small>
    <textarea id="menuImportInput" rows="3"></textarea>
    <div style="text-align:right;margin-top:6px;">
      <button id="importMenuBtn">â¬ åŒ¯å…¥èœå–®æ–‡å­—</button>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>#</th><th>å“é …åç¨±</th><th>å–®åƒ¹</th><th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody id="menuTbody"></tbody>
  </table>
</div>

<!-- â‘¡ è¨‚å–®è¼¸å…¥ -->
<div class="card">
  <h2>â‘¡ è¼¸å…¥è¨‚å–®</h2>
  <div class="input-row">
    <input id="username" placeholder="å§“å (ä¾‹ï¼šèå©·)" style="flex:1 1 120px;">
    <select id="menuSelect" style="flex:2 1 220px;"></select>
    <input id="qtyInput" type="number" min="1" value="1" style="width:70px;">
    <button id="addOrderBtn" disabled>â• åŠ å…¥è¨‚å–®</button>
  </div>

  <div style="margin-top:12px;">
    <small>è²¼ä¸Š UberEats è³¼ç‰©è»Šæ–‡å­—ï¼ˆå¾ã€Œèå©· (æ‚¨æœ¬äºº)ã€æˆ–ã€Œè¨ªå®¢1ã€é‚£é‚Šé–‹å§‹å…¨é¸è¤‡è£½ï¼‰ï¼š</small>
    <textarea id="cartTextInput" rows="7"
      placeholder="ä¾‹ï¼š
èå©· (æ‚¨æœ¬äºº)
2 ä»½é¤é»

1
è’œé¦™é›ªèŠ±ç‰›è‚‰å¹«ç±³çŸ­æ³•
$150.00
åŠ è¾£é¸æ“‡
å¾®è¾£

1
èˆ’è‚¥ä½è„‚å«©é›å¹«ç±³çŸ­æ³•
$135.00
åŠ è¾£é¸æ“‡
å°è¾£
å‚™è¨»ï¼šä¸åŠ é¦™èœ

è¨ªå®¢1
1 ä»½é¤é»

1
é‡èœèœœæ±ç‡’è‚‰å¹«ç±³çŸ­æ³•
$200.00
åŠ è¾£é¸æ“‡
å¤§è¾£
åŠ æ–™é¸æ“‡ ($65.00)
æ²™å—²ç‰›"></textarea>
    <div style="text-align:right;margin-top:6px;">
      <button id="parseCartBtn">ğŸ§¾ è§£æè³¼ç‰©è»Šæ–‡å­—ä¸¦åŠ å…¥è¨‚å–®</button>
    </div>
  </div>
</div>

<!-- â‘¢ è¨‚å–®æ˜ç´° -->
<div class="card">
  <h2>â‘¢ è¨‚å–®æ˜ç´°</h2>
  <table>
    <thead>
      <tr>
        <th>#</th><th>å§“å</th><th>å“é …</th><th>å–®åƒ¹</th><th>æ•¸é‡</th><th>å°è¨ˆ</th><th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody id="orderTbody"></tbody>
  </table>
</div>

<!-- â‘£ ç¸½è¨ˆ -->
<div class="card">
  <h2>ç¸½è¨ˆæ¦‚æ³</h2>
  <div id="grandTotalDisplay" class="total-box">ç›®å‰å°šæœªé»é¤</div>
</div>

<!-- â‘¤ äººå“¡çµ±è¨ˆ -->
<div class="card">
  <h2>ğŸ‘¤ äººå“¡çµ±è¨ˆ (èª°é»äº†ä»€éº¼)</h2>
  <div class="input-row" style="justify-content:flex-end;margin-bottom:6px;">
    <label style="font-size:13px;">
      æŠ˜æ‰£ï¼š
      <input id="discountInput" type="number" min="0" max="100" value="50" style="width:60px;"> %
      <span style="font-size:12px;color:#666;">ï¼ˆ100=åŸåƒ¹ï¼Œ90=ä¹æŠ˜ï¼‰</span>
    </label>
  </div>
  <table>
    <thead>
      <tr>
        <th>å§“å</th><th>å“é …å…§å®¹</th><th>ç¸½ä»½æ•¸</th><th>ç¸½é‡‘é¡</th><th>æŠ˜æ‰£å¾Œ</th>
      </tr>
    </thead>
    <tbody id="personTbody"></tbody>
  </table>
</div>

<!-- â‘¥ é¤é»çµ±è¨ˆ -->
<div class="card">
  <h2>ğŸ— é¤é»çµ±è¨ˆ (åº—å®¶å«è²¨ç”¨)</h2>
  <table>
    <thead>
      <tr>
        <th>å“é …åç¨±</th><th>ç¸½æ•¸é‡</th><th>ç¸½é‡‘é¡</th>
      </tr>
    </thead>
    <tbody id="itemTbody"></tbody>
  </table>
</div>

<button id="resetBtn" class="btn-danger" style="display:block;margin-left:auto;">
  âš  æ¸…é™¤æ‰€æœ‰è¨‚å–®é‡ä¾†ï¼ˆä¿ç•™èœå–®ï¼‰
</button>

<script>
(function(){
  const menuItems = [];          // {name, price}
  const orders    = [];          // {name, item, price, qty, detail}
  let menuEditingIndex = -1;
  let orderEditingIndex = -1;

  // DOM
  const menuNameInput  = document.getElementById('menuNameInput');
  const menuPriceInput = document.getElementById('menuPriceInput');
  const addMenuItemBtn = document.getElementById('addMenuItemBtn');
  const clearMenuBtn   = document.getElementById('clearMenuBtn');
  const menuImportInput= document.getElementById('menuImportInput');
  const importMenuBtn  = document.getElementById('importMenuBtn');
  const menuTbody      = document.getElementById('menuTbody');
  const menuSelect     = document.getElementById('menuSelect');

  const nameInput      = document.getElementById('username');
  const qtyInput       = document.getElementById('qtyInput');
  const addOrderBtn    = document.getElementById('addOrderBtn');

  const cartTextInput  = document.getElementById('cartTextInput');
  const parseCartBtn   = document.getElementById('parseCartBtn');

  const orderTbody     = document.getElementById('orderTbody');
  const grandTotalEl   = document.getElementById('grandTotalDisplay');
  const personTbody    = document.getElementById('personTbody');
  const itemTbody      = document.getElementById('itemTbody');
  const discountInput  = document.getElementById('discountInput');
  const resetBtn       = document.getElementById('resetBtn');

  const roundHalf = v => Math.floor(v + 0.5);

  /* ---------- èœå–® ---------- */
  function renderMenu(){
    if (!menuItems.length){
      menuTbody.innerHTML =
        '<tr><td colspan="4" style="text-align:center;color:#888;">å°šç„¡å“é …ï¼Œè«‹å…ˆæ–°å¢</td></tr>';
      menuSelect.innerHTML = '<option disabled selected>è«‹å…ˆæ–°å¢å“é …</option>';
      addOrderBtn.disabled = true;
      return;
    }
    menuTbody.innerHTML = menuItems.map((m,i)=>`
      <tr>
        <td>${i+1}</td>
        <td>${m.name}</td>
        <td>$${m.price}</td>
        <td>
          <button class="btn-sm btn-edit" data-idx="${i}" data-action="editMenu">ä¿®æ”¹</button>
          <button class="btn-sm btn-del"  data-idx="${i}" data-action="delMenu">åˆªé™¤</button>
        </td>
      </tr>`).join('');

    menuSelect.innerHTML = menuItems
      .map(m=>`<option value="${m.name}|${m.price}">${m.name} ($${m.price})</option>`)
      .join('');
    addOrderBtn.disabled = false;
  }

  function resetMenuForm(){
    menuNameInput.value = '';
    menuPriceInput.value = '';
    addMenuItemBtn.textContent = 'â• æ–°å¢å“é …';
    menuEditingIndex = -1;
  }

  function handleSubmitMenuItem(){
    const name  = menuNameInput.value.trim();
    const price = Number(menuPriceInput.value);
    if (!name) return alert('è«‹è¼¸å…¥å“é …åç¨±');
    if (Number.isNaN(price) || price < 0) return alert('è«‹è¼¸å…¥æ­£ç¢ºå–®åƒ¹');

    if (menuEditingIndex === -1){
      menuItems.push({name, price});
    }else{
      const old = menuItems[menuEditingIndex];
      menuItems[menuEditingIndex] = {name, price};
      // åŒæ­¥æ—¢æœ‰è¨‚å–®
      orders.forEach(o=>{
        if (o.item === old.name && o.price === old.price){
          o.item = name;
          o.price = price;
        }
      });
    }
    resetMenuForm();
    renderMenu();
    renderAll();
  }

  function handleImportMenu(){
    const txt = menuImportInput.value.trim();
    if (!txt) return alert('è«‹å…ˆè²¼ä¸Šæ–‡å­—');
    let added = 0;
    txt.split(/\r?\n/).forEach(line=>{
      const parts = line.split(/[,ï¼Œ\t]/).map(s=>s && s.trim());
      if (!parts[0]) return;
      const price = Number(parts[1]);
      if (Number.isNaN(price)) return;
      menuItems.push({name:parts[0], price});
      added++;
    });
    if (!added) return alert('æ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹ç”¨ã€Œå“é …,é‡‘é¡ã€');
    menuImportInput.value = '';
    renderMenu();
  }

  menuTbody.addEventListener('click', e=>{
    const btn = e.target.closest('button');
    if (!btn) return;
    const idx = Number(btn.dataset.idx);
    const action = btn.dataset.action;
    if (action === 'editMenu'){
      const m = menuItems[idx];
      menuEditingIndex = idx;
      menuNameInput.value = m.name;
      menuPriceInput.value = m.price;
      addMenuItemBtn.textContent = 'ğŸ’¾ å„²å­˜ä¿®æ”¹';
    }else if (action === 'delMenu'){
      if (!confirm('ç¢ºå®šåˆªé™¤æ­¤å“é …ï¼Ÿ')) return;
      menuItems.splice(idx,1);
      renderMenu();
      renderAll();
    }
  });

  clearMenuBtn.onclick = () => {
    if (!confirm('ç¢ºå®šæ¸…é™¤æ‰€æœ‰èœå–®å“é …ï¼Ÿï¼ˆä¸å½±éŸ¿è¨‚å–®è³‡æ–™ï¼‰')) return;
    menuItems.length = 0;
    resetMenuForm();
    renderMenu();
  };

  /* ---------- è³¼ç‰©è»Šè§£æ ---------- */

  function parseCartText(text){
    const lines = text
      .split(/\r?\n/)
      .map(l => l.trim())
      .filter(l => l.length);

    const IGNORES = ['ç¾¤çµ„ä¸­çš„å…¶ä»–äºº','å·²æ–°å¢é¤é»','â€¢','æ­£åœ¨æ–°å¢å•†å“'];
    const priceRegex = /\$([0-9][0-9.,]*)/;

    function isIgnoreLine(l){
      return IGNORES.some(x => l.includes(x));
    }
    function isUserLine(l){
      if (l.includes('(æ‚¨æœ¬äºº)')) return true;
      if (/^è¨ªå®¢\s*\d+/.test(l)) return true;
      return false;
    }

    const ordersFromCart = [];
    let currentName = null;
    let i = 0;

    while (i < lines.length){
      const line = lines[i];

      if (isUserLine(line)){
        currentName = line.replace('(æ‚¨æœ¬äºº)','').trim();
        i++;
        continue;
      }

      if (isIgnoreLine(line) || line.includes('ä»½é¤é»')){
        i++;
        continue;
      }

      if (line.includes('åŠ æ–™é¸æ“‡')){ // é€™ç¨®è¡Œåœ¨ç´°ç¯€è™•ç†
        i++;
        continue;
      }

      const priceMatch = line.match(priceRegex);
      if (!priceMatch){
        i++;
        continue;
      }

      const basePrice = parseFloat(priceMatch[1].replace(/,/g,'')) || 0;

      // å¾€ä¸Šæ‰¾é¤åå’Œä»½æ•¸
      let itemName = '';
      let qty = 1;
      for (let j = i - 1; j >= 0; j--){
        const prev = lines[j];
        if (isUserLine(prev) || prev.includes('ä»½é¤é»')) break;
        if (isIgnoreLine(prev)) continue;

        const qtyOnly = prev.match(/^(\d+)$/);
        const qtyWithWord = prev.match(/(\d+)\s*ä»½/);

        if (qtyOnly){
          qty = parseInt(qtyOnly[1],10);
          continue;
        }
        if (qtyWithWord){
          qty = parseInt(qtyWithWord[1],10);
          continue;
        }

        if (!itemName){
          itemName = prev;
          break;
        }
      }
      if (!itemName){
        i++;
        continue;
      }

      // å¾€ä¸‹æŠ“åŠ è¾£ / åŠ æ–™ / å‚™è¨»
      let detailParts = [];
      let extra = 0;
      let k = i + 1;

      while (k < lines.length){
        const l2 = lines[k];

        if (isUserLine(l2) || l2.includes('ä»½é¤é»') ||
           (priceRegex.test(l2) && !l2.includes('åŠ æ–™é¸æ“‡'))){
          break;
        }
        if (isIgnoreLine(l2)){
          k++;
          continue;
        }

        if (l2.includes('åŠ è¾£é¸æ“‡')){
          const level = lines[k+1] || '';
          if (level && !isUserLine(level) && !level.includes('ä»½é¤é»')){
            detailParts.push('åŠ è¾£ï¼š' + level);
          }
          k += 2;
          continue;
        }

        const addonMatch = l2.match(/åŠ æ–™é¸æ“‡.*\(\$([0-9][0-9.,]+)\)/);
        if (addonMatch){
          const addonPrice = parseFloat(addonMatch[1].replace(/,/g,'')) || 0;
          const addonName = lines[k+1] || '';
          extra += addonPrice;
          detailParts.push('åŠ æ–™ï¼š' + addonName + ' +' + addonPrice);
          k += 2;
          continue;
        }

        if (/^å‚™è¨»/.test(l2)){
          detailParts.push(l2);
          k++;
          continue;
        }

        k++;
      }

      ordersFromCart.push({
        name: currentName || 'æœªå‘½å',
        item: itemName,
        price: Math.round(basePrice + extra),
        qty,
        detail: detailParts.join(' / ')
      });

      i = k;
    }

    return ordersFromCart;
  }

  function handleParseCartOrders(){
    const text = cartTextInput.value.trim();
    if (!text) return alert('è«‹å…ˆè²¼ä¸Šè³¼ç‰©è»Šæ–‡å­—');

    const parsed = parseCartText(text);
    if (!parsed.length) return alert('æ²’æœ‰è§£æåˆ°ä»»ä½•é¤é»ï¼ˆæ ¼å¼å¯èƒ½ä¸åŒï¼‰');

    parsed.forEach(o=>{
      // èœå–®æ²’æœ‰é€™å“é …å°±é †ä¾¿åŠ å…¥
      if (!menuItems.some(m => m.name === o.item && m.price === o.price)){
        menuItems.push({name:o.item, price:o.price});
      }
      const idx = orders.findIndex(x =>
        x.name === o.name &&
        x.item === o.item &&
        x.price === o.price &&
        (x.detail || '') === (o.detail || '')
      );
      if (idx >= 0) orders[idx].qty += o.qty;
      else orders.push(o);
    });

    mergeOrders();
    renderMenu();
    renderAll();
    alert(`å·²å¾è³¼ç‰©è»Šè§£æå‡º ${parsed.length} ç­†é¤é»`);
    cartTextInput.value = '';
  }

  /* ---------- è¨‚å–® / çµ±è¨ˆ ---------- */

  function mergeOrders(){
    const map = {};
    orders.forEach(o=>{
      const key = `${o.name}|${o.item}|${o.price}|${o.detail||''}`;
      if (!map[key]) map[key] = {...o};
      else map[key].qty += o.qty;
    });
    const merged = Object.values(map);
    orders.length = 0;
    orders.push(...merged);
  }

  function resetOrderForm(){
    qtyInput.value = 1;
    addOrderBtn.textContent = 'â• åŠ å…¥è¨‚å–®';
    orderEditingIndex = -1;
  }

  function handleSubmitOrder(){
    const name = nameInput.value.trim();
    const qty  = parseInt(qtyInput.value,10);
    if (!name) return alert('è«‹è¼¸å…¥å§“å');
    if (!menuSelect.value) return alert('è«‹å…ˆæ–°å¢å“é …');
    if (Number.isNaN(qty) || qty <= 0) return alert('ä»½æ•¸è¦ â‰¥ 1');

    const [itemName, priceStr] = menuSelect.value.split('|');
    const price = Number(priceStr);
    if (!itemName || Number.isNaN(price)) return alert('å“é …è³‡æ–™éŒ¯èª¤');

    let detail = '';
    if (orderEditingIndex !== -1 && orders[orderEditingIndex]){
      detail = orders[orderEditingIndex].detail || '';
    }

    const newOrder = {name, item:itemName, price, qty, detail};

    if (orderEditingIndex === -1){
      const idx = orders.findIndex(o =>
        o.name===newOrder.name &&
        o.item===newOrder.item &&
        o.price===newOrder.price &&
        (o.detail||'')===(newOrder.detail||'')
      );
      if (idx>=0) orders[idx].qty += newOrder.qty;
      else orders.push(newOrder);
    }else{
      orders[orderEditingIndex] = newOrder;
      mergeOrders();
    }

    resetOrderForm();
    renderAll();
  }

  function renderOrderTable(){
    if (!orders.length){
      orderTbody.innerHTML =
        '<tr><td colspan="7" style="text-align:center;color:#888;">å°šç„¡è¨‚å–®</td></tr>';
      return;
    }
    orderTbody.innerHTML = orders.map((o,i)=>{
      const sub = o.qty * o.price;
      const detailHtml = o.detail
        ? `<br><span style="font-size:12px;color:#666;">${o.detail}</span>`
        : '';
      return `
        <tr>
          <td>${i+1}</td>
          <td>${o.name}</td>
          <td>${o.item}${detailHtml}</td>
          <td>$${o.price}</td>
          <td>${o.qty}</td>
          <td>$${sub}</td>
          <td>
            <button class="btn-sm btn-edit" data-idx="${i}" data-action="editOrder">ä¿®æ”¹</button>
            <button class="btn-sm btn-del"  data-idx="${i}" data-action="delOrder">åˆªé™¤</button>
          </td>
        </tr>`;
    }).join('');
  }

  orderTbody.addEventListener('click', e=>{
    const btn = e.target.closest('button');
    if (!btn) return;
    const idx = Number(btn.dataset.idx);
    const action = btn.dataset.action;
    if (action === 'editOrder'){
      const o = orders[idx];
      orderEditingIndex = idx;
      nameInput.value = o.name;
      qtyInput.value  = o.qty;
      menuSelect.value = `${o.item}|${o.price}`;
      addOrderBtn.textContent = 'ğŸ’¾ å„²å­˜ä¿®æ”¹';
    }else if (action === 'delOrder'){
      if (!confirm('ç¢ºå®šåˆªé™¤æ­¤è¨‚å–®ï¼Ÿ')) return;
      orders.splice(idx,1);
      resetOrderForm();
      renderAll();
    }
  });

  function renderStats(){
    if (!orders.length){
      grandTotalEl.textContent = 'ç›®å‰å°šæœªé»é¤';
      personTbody.innerHTML = '';
      itemTbody.innerHTML   = '';
      return;
    }

    const personStats = {};  // name -> {items[], qty, total}
    const itemStats   = {};  // item -> {qty, total, details[]}
    let totalQty = 0;
    let totalMoney = 0;

    orders.forEach(o=>{
      const sub = o.qty * o.price;
      totalQty   += o.qty;
      totalMoney += sub;

      if (!personStats[o.name]) personStats[o.name] = {items:[], qty:0, total:0};
      const p = personStats[o.name];
      p.items.push(o.detail ? `${o.item} x${o.qty}ï¼ˆ${o.detail}ï¼‰` : `${o.item} x${o.qty}`);
      p.qty   += o.qty;
      p.total += sub;

      if (!itemStats[o.item]) itemStats[o.item] = {qty:0, total:0, details:[]};
      const it = itemStats[o.item];
      it.qty   += o.qty;
      it.total += sub;
      if (o.detail) it.details.push(`${o.detail} x${o.qty}`);
    });

    grandTotalEl.textContent = `ç¸½ä»½æ•¸ï¼š${totalQty} ä»½ ï½œ ç¸½é‡‘é¡ï¼š$${totalMoney}`;

    let d = Number(discountInput.value);
    if (Number.isNaN(d) || d <= 0) d = 100;
    if (d > 100) d = 100;
    const factor = d / 100;

    personTbody.innerHTML = Object.entries(personStats)
      .sort(([a],[b])=>a.localeCompare(b,'zh-Hant'))
      .map(([name,data])=>{
        const disc = roundHalf(data.total * factor);
        return `
          <tr>
            <td>${name}</td>
            <td style="font-size:12px;color:#555;">${data.items.join('ã€')}</td>
            <td>${data.qty}</td>
            <td style="color:#d9534f;font-weight:bold;">$${data.total}</td>
            <td style="color:#28a745;font-weight:bold;">$${disc}</td>
          </tr>`;
      }).join('');

    itemTbody.innerHTML = Object.entries(itemStats)
      .sort(([a],[b])=>a.localeCompare(b,'zh-Hant'))
      .map(([item,data])=>{
        const detailHtml = data.details.length
          ? `<div style="margin-top:4px;font-size:12px;color:#666;">
               ${data.details.map(t=>`<div>ãƒ»${t}</div>`).join('')}
             </div>` : '';
        return `
          <tr>
            <td>${item}${detailHtml}</td>
            <td style="font-weight:bold;">${data.qty}</td>
            <td>$${data.total}</td>
          </tr>`;
      }).join('');
  }

  function renderAll(){
    renderOrderTable();
    renderStats();
  }

  /* ---------- äº‹ä»¶ç¶å®š ---------- */
  addMenuItemBtn.onclick = handleSubmitMenuItem;
  menuPriceInput.onkeydown = e => { if (e.key === 'Enter') handleSubmitMenuItem(); };
  importMenuBtn.onclick = handleImportMenu;

  addOrderBtn.onclick = handleSubmitOrder;
  nameInput.onkeydown = e => { if (e.key === 'Enter') handleSubmitOrder(); };
  qtyInput.onkeydown  = e => { if (e.key === 'Enter') handleSubmitOrder(); };

  parseCartBtn.onclick = handleParseCartOrders;
  discountInput.oninput = renderAll;

  resetBtn.onclick = () => {
    if (!confirm('æ¸…é™¤æ‰€æœ‰è¨‚å–®ï¼Ÿï¼ˆèœå–®ä¿ç•™ï¼‰')) return;
    orders.length = 0;
    resetOrderForm();
    renderAll();
  };

  // åˆå§‹åŒ–
  renderMenu();
  renderAll();
})();
</script>

</body>
</html>
